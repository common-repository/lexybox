/**
 * LexyBox
 * @author Lex Lexter <hi@leximo.cz>
 * @version 1.1.5
 * @update 24.11.2022
 * @website https://lexybox.leximo.cz/
 */

var LexyBox=function(){function e(e,o){var r,a;this.selector=e,this.options=Object.assign({effect:"horizontal",theme:"dark",swipe:100,loop:!1,single:!1,pager:!0,preload:!1,autoplay:5e3,label_close:"Close",label_prev:"Previous",label_next:"Next",label_pager:"Pagination",label_autoplay:"Play/Pause",before_open:null,after_open:null,before_move:null,after_move:null,before_close:null,after_close:null},o),this.media=[],this.active=0,this.total=0,this.single=!1,this.objects={},this.touch={startX:0,endX:0,startY:0,endY:0},this.autoplay=null,this.services={image:{html:'<img alt="%alt" src="%src" class="lexybox-image">',finder:function(e,t){return null!=e.match(/\.(jpeg|jpg|gif|png|svg|webp)$/)},parser:function(e,t){return{src:e,alt:t.hasAttribute("title")?t.getAttribute("title"):"Image"}},thumb:function(e,t,o){return e}},video:{html:'<video src="%src" width="400" height="300" class="lexybox-video" controls %poster>Your browser does not support the video tag.</video>',finder:function(e,t){return null!=e.match(/\.(mp4|ogg|webm)$/)},parser:function(e,t){var o=t.hasAttribute("data-lexybox-poster")?t.getAttribute("data-lexybox-poster"):null;return{src:e,poster:o?'poster="'+o+'"':""}},thumb:function(e,t,o){return t.hasAttribute("data-lexybox-poster")?t.getAttribute("data-lexybox-poster"):""}},youtube:{html:'<iframe src="%src" class="lexybox-iframe" allowfullscreen>Your browser does not support the iframe tag.</iframe>',finder:function(e,t){return null!=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/)},parser:function(e,t){var o=e.match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return o&&11==o[2].length?{src:"https://www.youtube.com/embed/"+o[2],code:o[2]}:null},thumb:function(e,t,o){return"https://img.youtube.com/vi/"+o.code+"/sddefault.jpg"}},vimeo:{html:'<iframe src="%src" class="lexybox-iframe">Your browser does not support the iframe tag.</iframe>',finder:function(e,t){return null!=e.match(/^(http\:\/\/|https\:\/\/)?(www\.)?(vimeo\.com\/)([0-9]+)$/)},parser:function(e,t){var o=e.match(/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/);return o?{src:"https://player.vimeo.com/video/"+o[5]}:null},thumb:function(e,t,o){return""}}},this.markup={base:['<div class="lexybox '+(s(this.options.effect,["horizontal","vertical","fade"])?" lexybox--effect":"")+(this.options.effect?" lexybox--effect-"+this.options.effect:"")+(s(this.options.theme,["dark","light","classic"])?" lexybox--theme":"")+(this.options.theme?" lexybox--theme-"+this.options.theme:"")+'"><div class="lexybox-window"><div class="lexybox-content"><div class="lexybox-track">%items</div></div><span class="lexybox-title"></span><div class="lexybox-count"><span class="lexybox-count__current"></span><span class="lexybox-count__sep"></span><span class="lexybox-count__total"></span></div><a href="#" class="lexybox-control lexybox-control--close">'+this.options.label_close+"</a>"+(this.options.single?"":'<a href="#" class="lexybox-control lexybox-control--prev">'+this.options.label_prev+"</a>")+(this.options.single?"":'<a href="#" class="lexybox-control lexybox-control--next">'+this.options.label_next+"</a>")+(this.options.single?"":'<a href="#" class="lexybox-control lexybox-control--grid">'+this.options.label_pager+"</a>")+(!this.options.single&&this.options.autoplay>0?'<a href="#" class="lexybox-control lexybox-control--play">'+this.options.label_autoplay+"</a>":"")+'<div class="lexybox-pager">%pages</div></div><div>'].join(""),item:'<div class="lexybox-item">%item</div>',page:'<a href="#" class="lexybox-page" data-index="%index" %thumb><span class="lexybox-page__num">%page</span><span class="lexybox-page__title">%title</span></a>'},r=this,a=void 0===window.lexybox_services?{}:window.lexybox_services,Object.assign(r.services,a),t(this,!1)}function t(e,t){if(t){for(var s=0;s<e.objects.pages.length;s++)e.objects.pages[s].addEventListener("click",function(t){t.preventDefault(),p(e,t.currentTarget.getAttribute("data-index"))});e.objects.close.addEventListener("click",function(t){t.preventDefault(),u(e)}),e.objects.grid&&e.objects.grid.addEventListener("click",function(t){var s;t.preventDefault(),s=e,o(s.objects.wrap,"lexybox--pager"),r(s),e.options.preload||function e(t){t.objects.pages.forEach(function(e,o){!t.objects.pages[o].hasAttribute("style")&&t.media[o].thumb&&(t.objects.pages[o].style.backgroundImage="url("+t.media[o].thumb+")")})}(e)}),e.objects.play&&e.options.autoplay&&e.objects.play.addEventListener("click",function(t){t.preventDefault(),function e(t,o=!1){t.autoplay||o?r(t):(t.objects.wrap.classList.add("lexybox--playing"),t.autoplay=setInterval(function(){d(t,!1),t.active+1==t.total&&(clearInterval(t.autoplay),t.autoplay=null,t.objects.wrap.classList.remove("lexybox--playing"))},t.options.autoplay))}(e)}),e.objects.prev&&e.objects.prev.addEventListener("click",function(t){t.preventDefault(),b(e)}),e.objects.next&&e.objects.next.addEventListener("click",function(t){t.preventDefault(),d(e)}),window.onkeydown=function(t){"Escape"==t.key&&u(e),"ArrowLeft"==t.key||"ArrowUp"==t.key?b(e):("ArrowRight"==t.key||"ArrowDown"==t.key)&&d(e)},e.options.swipe>0&&(e.objects.content.addEventListener("touchstart",function(t){e.touch.startX=t.changedTouches[0].screenX,e.touch.startY=t.changedTouches[0].screenY}),e.objects.content.addEventListener("touchend",function(t){e.touch.endX=t.changedTouches[0].screenX,e.touch.endY=t.changedTouches[0].screenY;var o,s=(o=e,o.touch.endX+o.options.swipe<o.touch.startX?"left":o.touch.endX>o.touch.startX+o.options.swipe?"right":o.touch.endY+o.options.swipe<o.touch.startY?"up":o.touch.endY>o.touch.startY+o.options.swipe?"down":"tap");"left"==s||s==("vertical"==e.effect?"down":"up")?d(e):("right"==s||s==("vertical"==e.effect?"up":"down"))&&b(e)}))}for(var a=document.querySelectorAll(e.selector),s=0;s<a.length;s++)a[s].addEventListener("click",function(t){t.preventDefault(),c(e)&&u(e),l(e,n(e,a,t.currentTarget.getAttribute("href"),t.currentTarget.getAttribute("rel")))})}function o(e,t,o){o||void 0==o&&!e.classList.contains(t)?e.classList.add(t):(!o||void 0==o&&e.classList.contains(t))&&e.classList.remove(t)}function s(e,t){for(var o=t.length,s=0;s<o;s++)if(t[s]==e)return!0;return!1}function r(e){clearInterval(e.autoplay),e.autoplay=null,e.objects.wrap.classList.remove("lexybox--playing")}function a(e,t){e.objects.items.forEach(function(o,s){s==t?(o.classList.add("lexybox-item--active"),e.options.preload||i(e,s)):o.classList.remove("lexybox-item--active"),s==t-1?(o.classList.add("lexybox-item--prev"),e.options.preload||i(e,s)):o.classList.remove("lexybox-item--prev"),s==t+1?(o.classList.add("lexybox-item--next"),e.options.preload||i(e,s)):o.classList.remove("lexybox-item--next")}),e.media.forEach(function(o,s){e.media[s].active=s==t}),e.options.pager&&e.objects.pages.forEach(function(e,s){o(e,"lexybox-page--active",s==t)}),e.active=t}function i(e,t){"%item"==e.objects.items[t].innerHTML&&(e.objects.items[t].innerHTML=e.media[t].html)}function n(e,t,o,s){var r=[];return t.forEach(function(t){var a,i,n,l,c;(!s||t.getAttribute("rel")===s)&&(parse=(a=e,i=t,n=o,l={},c=i.getAttribute("href"),Object.keys(a.services).forEach(function(e){if(a.services[e].finder(c,i)&&(params=a.services[e].parser(c,i))){var t=a.services[e].html;Object.keys(params).forEach(function(e){t=t.replace("%"+e,params[e])}),l.html=t,l.url=c,l.title=i.hasAttribute("title")?i.getAttribute("title"):null,l.active=c==n,l.service=e,l.thumb=i.hasAttribute("data-lexybox-thumbnail")?i.getAttribute("data-lexybox-thumbnail"):void 0!==a.services[e].thumb?a.services[e].thumb(c,i,params):""}}),void 0!==l.html?l:null))&&r.push(parse)}),r}function l(e,s){var r,a;if(r=e,a=s,r.media=[],Object.keys(a).forEach(e=>{void 0!=a[e].html&&(a[e].active&&(r.active=e),r.media.push(a[e]))}),r.total=r.media.length,(1==r.total||r.options.single)&&(r.single=!0,r.media=[r.media[r.active]],r.active=0),"function"==typeof e.options.before_open&&e.options.before_open(e.media),0==e.media.length)return console.log("empty media stack"),!1;(function e(s){var r,a=s.markup,i="",n="";s.media.forEach(function(e,t){i+=s.options.preload?a.item.replace("%item",e.html):a.item,s.options.pager&&!s.single&&(n+=a.page.replace("%index",t).replace("%page",t+1).replace("%title",e.title?e.title:"").replace("%thumb",s.options.preload&&e.thumb?'style="background-image:url('+e.thumb+');"':""))});let l=document.createElement("div");l.innerHTML=a.base.replace("%items",i).replace("%pages",n),document.body.appendChild(l.firstChild),(r=s).objects={wrap:document.querySelector(".lexybox"),title:document.querySelector(".lexybox-title"),count:document.querySelector(".lexybox-count"),current:document.querySelector(".lexybox-count__current"),total:document.querySelector(".lexybox-count__total"),prev:document.querySelector(".lexybox-control--prev"),next:document.querySelector(".lexybox-control--next"),close:document.querySelector(".lexybox-control--close"),grid:document.querySelector(".lexybox-control--grid"),play:document.querySelector(".lexybox-control--play"),content:document.querySelector(".lexybox-content"),track:document.querySelector(".lexybox-track"),items:document.querySelectorAll(".lexybox-item"),pager:document.querySelector(".lexybox-pager"),pages:document.querySelectorAll(".lexybox-page")},s.objects.total.innerText=s.total,o(s.objects.wrap,"lexybox--mode-single",s.single),document.body.classList.add("lexybox-body"),s.single&&(s.objects.prev&&s.objects.prev.remove(),s.objects.next&&s.objects.next.remove(),s.objects.grid&&s.objects.grid.remove(),s.objects.count&&s.objects.count.remove(),s.objects.pager&&s.objects.pager.remove(),s.objects.play&&s.objects.play.remove()),s.options.pager||(s.objects.grid.remove(),s.objects.pager.remove()),setTimeout(function(){s.objects.wrap.classList.add("lexybox--visible")},1),t(s,!0)})(e),p(e,e.active,null),"function"==typeof e.options.after_open&&e.options.after_open(e.media,e.active,e.objects)}function c(e){return void 0!==e.objects.wrap}function u(e){var t,o,s;"function"==typeof e.options.before_close&&e.options.before_close(e.media,e.objects),r(e),(t=e).media=[],(o=e).objects.wrap.remove(),document.body.classList.remove("lexybox-body"),(s=e).objects={},e.active=0,e.single=!1,"function"==typeof e.options.after_close&&e.options.after_close()}function p(e,t,s,i=!0){var n,l,c,u;if((t=parseInt(t))in e.media&&(e.objects.title.innerText=e.media[t].title),e.single){a(e,0);return}if(e.objects.wrap.classList.add("lexybox--loading"),e.options.loop&&e.media.length>1&&(t<0&&(t=e.media.length-1),t==e.media.length&&(t=0)),!(t in e.media)){u=e,u.objects.wrap.classList.add("lexybox--shake"),setTimeout(function(){u.objects.wrap.classList.remove("lexybox--shake")},1e3);return}e.objects.current.innerText=t+1,n=e,l=t,c=s,"function"==typeof n.options.before_move&&n.options.before_move(c,n.media,n.active,n.objects),"horizontal"==n.options.effect?(n.objects.track.style.transform="-webkit-translateX(-"+100*l+"%)",n.objects.track.style.transform="-ms-translateX(-"+100*l+"%)",n.objects.track.style.transform="translateX(-"+100*l+"%)"):"vertical"==n.options.effect&&(n.objects.track.style.transform="-webkit-translateY(-"+100*l+"%)",n.objects.track.style.transform="-ms-translateY(-"+100*l+"%)",n.objects.track.style.transform="translateY(-"+100*l+"%)"),a(n,l),"function"==typeof n.options.after_move&&n.options.after_move(c,n.media,n.active,n.objects),e.options.loop||(o(e.objects.prev,"lexybox-control--disabled",0==t),o(e.objects.next,"lexybox-control--disabled",t+1==e.total)),function e(t,o){var s,r,a;t.objects.items.forEach(function(e,t){t!==o&&(s=e.querySelector("iframe"),r=e.querySelector("video"),s&&(a=s.getAttribute("src"),s.removeAttribute("src"),s.src=a),r&&r.pause())})}(e,t),i&&r(e),setTimeout(function(){e.objects.wrap&&e.objects.wrap.classList.remove("lexybox--loading")},1e3)}function b(e){p(e,e.active-1,"prev")}function d(e,t){p(e,e.active+1,"next",t)}return e.prototype.open=function(e){l(this,e)},e.prototype.close=function(){u(this)},e.prototype.add_service=function(e,t){var o,s,r;o=this,s=e,r=t,o.services[s]=r},e}();